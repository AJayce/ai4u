<html>
  <head>
    <title>
      Hangman's Helper
    </title>
    <script>
      function Request(service, opt_argv) {
        if (!opt_argv) opt_argv = Array();

        var callback = null;
        var len = opt_argv.length;
        if (len > 0 && typeof opt_argv[len-1] == 'function') {
          callback = opt_argv[len-1];
          opt_argv.length--;
        }
        var async = (callback != null);

        var query = '/' + encodeURIComponent(service);
        if (opt_argv.length > 0) {
          var key = 'arg0';
          var val = JSON.stringify(opt_argv[0]);
          query += '?' + key + '=' + encodeURIComponent(val);
        }
        for (var i = 1; i < opt_argv.length; i++) {
          var key = 'arg' + i;
          var val = JSON.stringify(opt_argv[i]);
          query += '&' + key + '=' + encodeURIComponent(val);
        }
        query += '&ts=' + new Date().getTime();

        var req = new XMLHttpRequest();
        req.open('GET', query, async);

        if (async) {
          req.onreadystatechange = function() {
            if (req.readyState == 4 && req.status == 200) {
              var response = null;
              try {
                response = JSON.parse(req.responseText);
              } catch (e) {
                response = req.responseText;
              }
              callback(response);
            }
          }
        }

        req.send(null);
      }

      function installFunction(obj, name) {
        obj[name] = function() {
          Request(name, arguments);
        }
      }

      var server = {};
      installFunction(server, 'words');

      function showResult(resultJson) {
        if (resultJson.error != undefined) {
          alert(resultJson.error);
        } else {
          for (var i in resultJson.results) {
            var result = resultJson.results[i];

            var table = document.getElementById('resultsTable');
            var row = document.createElement('tr');
            var column = document.createElement('td');
            column.textContent = result;
            row.appendChild(column);
            table.appendChild(row);
          }
        }
      }

      function search(template, letters) {
        server.words(template, letters, showResult);
      }

    </script>
  </head>
  <body>
    <form onSubmit="search(searchForm.template.value, searchForm.letters.value);" id="searchForm">
      <table>
        <tr>
          <td>
            Template:
          </td>
          <td>
            <input name="template" type="text"/></br>
          </td>
        </tr>
        <tr>
          <td>
            Bad Letters:
          </td>
          <td>
            <input name="letters" type="text"/>
          </td>
        </tr>
        <tr>
          <td>
            <button type="button" onClick="search(searchForm.template.value, searchForm.letters.value);">Search</button>
          </td>
        </tr>
      </table>
    </form>
    <table id="resultsTable"/>
  </body>
</html>
    </form>
  </body>
</html>
